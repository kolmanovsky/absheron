<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Изображения{% if tag %} — тег: {{ tag }}{% endif %} — Absheron</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:1200px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
    .thumb{width:100%;height:160px;object-fit:cover;border-radius:8px;background:#f3f4f6}
    .muted{color:#6b7280}
    .tag{background:#f3f4f6;color:#374151;padding:2px 8px;border-radius:999px;font-size:12px;margin-right:6px;white-space:nowrap}
    .pager a, .pager span{margin-right:8px;text-decoration:none}
    header a{color:#2563eb;text-decoration:none}
  </style>
</head>
<body>
  <header style="margin-bottom:16px">
    <a href="/">← На главную</a>
  </header>

  <h1 style="margin:0 0 8px">Все изображения {% if tag %}<span class="muted">· тег: {{ tag }}</span>{% endif %}</h1>

  {% if page_obj.object_list %}
    <div class="grid">
      {% for img in page_obj.object_list %}
        <div class="card">
          <a href="{% url 'image_detail' img.id %}">
            {% if img.file %}<img class="thumb" src="{{ img.file.url }}" alt="image {{ img.id }}">{% else %}<div class="thumb"></div>{% endif %}
          </a>
          <div class="muted" style="margin-top:8px">
            {{ img.uploaded_by.username }} · {{ img.uploaded_at|date:"Y-m-d H:i" }}
          </div>
          {% if img.tags.all %}
            <div style="margin-top:8px">
              {% for tg in img.tags.all %}
                <a class="tag" href="{% url 'image_list' %}?tag={{ tg.name|urlencode }}">{{ tg.name }}</a>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <nav class="pager" style="margin-top:16px">
      {% if page_obj.has_previous %}
        <a href="?{% if tag %}tag={{ tag|urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">&laquo; Назад</a>
      {% else %}
        <span class="muted">&laquo; Назад</span>
      {% endif %}

      <span class="muted">Стр. {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?{% if tag %}tag={{ tag|urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Вперёд &raquo;</a>
      {% else %}
        <span class="muted">Вперёд &raquo;</span>
      {% endif %}
    </nav>
  {% else %}
    <p class="muted">Пока нет изображений{% if tag %} с тегом «{{ tag }}»{% endif %}.</p>
  {% endif %}
</body>
</html>
